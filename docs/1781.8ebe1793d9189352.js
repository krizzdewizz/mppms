"use strict";(self.webpackChunkmppm=self.webpackChunkmppm||[]).push([[1781],{1781:(D,g,i)=>{i.r(g),i.d(g,{AddTrackPageModule:()=>y});var v=i(1048),h=i(9508),u=i(3957),o=i(1412),f=i(8239),p=i(9481),T=i(9077),t=i(257),C=i(1038),k=i(4863),A=i(8322);const _=["nameInput"];let P=(()=>{class a{constructor(e,n,r,d,c,Z){this.activatedRoute=e,this.tracksService=n,this.nav=r,this.toastController=d,this.xlate=c,this.ytDownloadService=Z,this.hidden=!0,this.onDragOver=l=>l.preventDefault(),this.onDrop=l=>{l.preventDefault();const m=l.dataTransfer;!m.files||(this.file=m.files[0],this.track.name=this.file.name)}}ngOnInit(){if(this.trackIndex=Number(this.activatedRoute.snapshot.paramMap.get("index")),this.track={name:"",videoUrl:"",markers:[]},-1!==this.trackIndex){const e=this.tracksService.tracks[this.trackIndex];this.track.name=e.name,this.track.videoUrl=e.videoUrl}setTimeout(()=>this.hidden=!1,250)}ionViewWillEnter(){const e=(0,p.h)();e&&(this.track.videoUrl=e.id.videoId,this.track.name||(this.track.name=e.snippet.title),(0,p.F)(void 0)),document.body.addEventListener("dragover",this.onDragOver),document.body.addEventListener("drop",this.onDrop),setTimeout(()=>{var n,r;0===(null===(r=null===(n=this.track)||void 0===n?void 0:n.name)||void 0===r?void 0:r.length)&&this.ionInput.setFocus()},1e3)}ionViewWillLeave(){document.body.removeEventListener("dragover",this.onDragOver),document.body.removeEventListener("drop",this.onDrop)}addTrack(){let e=!1;if(this.file)this.tracksService.addFileTrack(this.file,this.track.name),e=!0;else{if(-1!==this.trackIndex){const n=this.tracksService.tracks[this.trackIndex];n.name=this.track.name,n.videoUrl=this.track.videoUrl}else e=!0,this.tracksService.tracks.push(Object.assign({},this.track));this.tracksService.saveTracks()}setTimeout(()=>{const n=this.nav.pop();e&&n.then(()=>this.nav.navigateRoot(["/home"],{animated:!1})).then(()=>this.nav.navigateForward(["/track",this.tracksService.tracks.length-1],{animated:!1}))})}ytSearch(){this.nav.navigateForward("/yt-search")}onFileChanged(e){this.file=e.target.files[0],this.track.name=this.file.name}ytDownload(e){var n=this;return(0,f.Z)(function*(){n.downloading||(n.downloading=!0,(yield n.ytDownloadService.initiateDownload((0,T.J)(e),n.track.name))||(yield n.toastController.create({message:n.xlate.transform("C_YT_DOWNLOAD_ERROR"),duration:4e3})).present(),n.downloading=!1)})()}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(u.gz),t.Y36(C.X),t.Y36(o.SH),t.Y36(o.yF),t.Y36(k.j),t.Y36(A.Q))},a.\u0275cmp=t.Xpm({type:a,selectors:[["mppm-add-track"]],viewQuery:function(e,n){if(1&e&&t.Gf(_,5),2&e){let r;t.iGM(r=t.CRH())&&(n.ionInput=r.first)}},hostVars:2,hostBindings:function(e,n){2&e&&t.ekj("hidden",n.hidden)},decls:26,vars:22,consts:[["scroll-y","false"],[1,"add-track-content"],["clear-input","",3,"placeholder","ngModel","ngModelChange"],["nameInput",""],["name","search",3,"click"],["name","download",3,"click"],["type","indeterminate",1,"progress"],[1,"choose-file",3,"click"],["type","file","hidden","","accept","audio/*",3,"change"],["fileInput",""],[1,"add",3,"disabled","click"]],template:function(e,n){if(1&e){const r=t.EpF();t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons"),t._UZ(3,"ion-back-button"),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"xlate"),t.qZA()()(),t.TgZ(7,"ion-content",0)(8,"div",1)(9,"ion-input",2,3),t.NdJ("ngModelChange",function(c){return n.track.name=c}),t.ALo(11,"xlate"),t.qZA(),t.TgZ(12,"ion-input",2),t.NdJ("ngModelChange",function(c){return n.track.videoUrl=c}),t.ALo(13,"xlate"),t.qZA(),t.TgZ(14,"ion-icon",4),t.NdJ("click",function(){return n.ytSearch()}),t.qZA(),t.TgZ(15,"ion-icon",5),t.NdJ("click",function(){return n.ytDownload(n.track.videoUrl)}),t.qZA(),t._UZ(16,"ion-progress-bar",6),t.TgZ(17,"div")(18,"ion-button",7),t.NdJ("click",function(){return t.CHM(r),t.MAs(22).click()}),t._uU(19),t.ALo(20,"xlate"),t.qZA(),t.TgZ(21,"input",8,9),t.NdJ("change",function(c){return n.onFileChanged(c)}),t.qZA()(),t.TgZ(23,"ion-button",10),t.NdJ("click",function(){return n.addTrack()}),t._uU(24),t.ALo(25,"xlate"),t.qZA()()()}2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,12,n.trackIndex<0?"C_ADD_TRACK":"C_EDIT_TRACK")),t.xp6(4),t.Q6J("placeholder",t.lcZ(11,14,"C_NAME"))("ngModel",n.track.name),t.xp6(3),t.Q6J("placeholder",t.lcZ(13,16,"C_YT_OR_VIDEO_ID"))("ngModel",n.track.videoUrl),t.xp6(3),t.ekj("hidden",!n.track.videoUrl),t.xp6(1),t.ekj("hidden",!n.downloading),t.xp6(3),t.hij(" ",t.lcZ(20,18,"C_LOCAL_AUDIO_FILE")," "),t.xp6(4),t.Q6J("disabled",!n.track.name||!n.track.videoUrl&&!n.file),t.xp6(1),t.hij(" ",t.lcZ(25,20,n.trackIndex<0?"C_ADD":"C_SAVE"),""))},directives:[o.Gu,o.sr,o.Sm,o.oU,o.cs,o.wd,o.W2,o.pK,o.j9,h.JJ,h.On,o.gu,o.X7,o.YG],pipes:[k.j],styles:[".hidden[_nghost-%COMP%]{display:none}.add-track-content[_ngcontent-%COMP%]{padding:16px;display:grid;grid-template-columns:auto 35px}.add-track-content[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{grid-column:1}.add-track-content[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]:nth-child(2){color:#aaa}.add-track-content[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{grid-column:2;justify-self:end;font-size:25pt;position:relative;top:-35px;cursor:pointer}.add-track-content[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]{grid-column:2;justify-self:end;position:relative;top:-35px}.add-track-content[_ngcontent-%COMP%]   .progress.hidden[_ngcontent-%COMP%]{visibility:hidden}.add-track-content[_ngcontent-%COMP%]   ion-icon[name=search][_ngcontent-%COMP%]{color:#aaa}.add-track-content[_ngcontent-%COMP%]   ion-icon[name=download][_ngcontent-%COMP%]{position:relative;top:-37px;color:var(--ion-color-primary);cursor:pointer}.add-track-content[_ngcontent-%COMP%]   ion-icon[name=download].hidden[_ngcontent-%COMP%]{visibility:hidden}.add-track-content[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{grid-column:1/3}.add[_ngcontent-%COMP%]{margin-top:20px}.choose-file[_ngcontent-%COMP%]{--background: transparent;--border-width: 0;--box-shadow: none;text-transform:none;font-size:16px}"]}),a})();var M=i(9174);const O=[{path:"",component:P}];let y=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[[v.ez,M.q,h.u5,o.Pc,u.Bz.forChild(O)]]}),a})()}}]);